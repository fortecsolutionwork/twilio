(this["webpackJsonpreact-express-starter"]=this["webpackJsonpreact-express-starter"]||[]).push([[0],{202:function(e,t,n){"use strict";n.r(t);var c=n(2),r=n(79),a=n.n(r),i=(n(86),n(87),n(32)),o=n.n(i),u=n(80),s=n(7),d=n(81),l=n.n(d),j=n(0),f=function(e){var t=e.username,n=e.handleUsernameChange,c=e.roomName,r=e.handleRoomNameChange,a=e.handleSubmit,i=e.connecting;return Object(j.jsxs)("form",{onSubmit:a,children:[Object(j.jsx)("h2",{children:"Enter a room"}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{htmlFor:"name",children:"Name:"}),Object(j.jsx)("input",{type:"text",id:"field",value:t,onChange:n,readOnly:i,required:!0})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{htmlFor:"room",children:"Room name:"}),Object(j.jsx)("input",{type:"text",id:"room",value:c,onChange:r,readOnly:i,required:!0})]}),Object(j.jsx)("button",{type:"submit",disabled:i,children:i?"Connecting":"Join"})]})},b=n(19),h=function(e){var t=e.participant,n=Object(c.useState)([]),r=Object(s.a)(n,2),a=r[0],i=r[1],o=Object(c.useState)([]),u=Object(s.a)(o,2),d=u[0],l=u[1],f=Object(c.useRef)(),h=Object(c.useRef)(),O=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(c.useEffect)((function(){i(O(t.videoTracks)),l(O(t.audioTracks));return t.on("trackSubscribed",(function(e){"video"===e.kind?i((function(t){return[].concat(Object(b.a)(t),[e])})):"audio"===e.kind&&l((function(t){return[].concat(Object(b.a)(t),[e])}))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?i((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&l((function(t){return t.filter((function(t){return t!==e}))}))})),function(){i([]),l([]),t.removeAllListeners()}}),[t]),Object(c.useEffect)((function(){var e=a[0];if(e)return e.attach(f.current),function(){e.detach()}}),[a]),Object(c.useEffect)((function(){var e=d[0];if(e)return e.attach(h.current),function(){e.detach()}}),[d]),Object(j.jsxs)("div",{className:"participant",children:[Object(j.jsx)("h3",{children:t.identity}),Object(j.jsx)("video",{ref:f,autoPlay:!0}),Object(j.jsx)("audio",{ref:h,autoPlay:!0,muted:!0})]})},O=function(e){var t=e.roomName,n=e.room,r=e.handleLogout,a=Object(c.useState)([]),i=Object(s.a)(a,2),o=i[0],u=i[1];Object(c.useEffect)((function(){var e=function(e){u((function(t){return[].concat(Object(b.a)(t),[e])}))},t=function(e){u((function(t){return t.filter((function(t){return t!==e}))}))};return n.on("participantConnected",e),n.on("participantDisconnected",t),n.participants.forEach(e),function(){n.off("participantConnected",e),n.off("participantDisconnected",t)}}),[n]);var d=o.map((function(e){return Object(j.jsx)(h,{participant:e},e.sid)}));return Object(j.jsxs)("div",{className:"room",children:[Object(j.jsxs)("h2",{children:["Room: ",t]}),Object(j.jsx)("button",{onClick:r,children:"Log out"}),Object(j.jsx)("div",{className:"local-participant",children:n?Object(j.jsx)(h,{participant:n.localParticipant},n.localParticipant.sid):""}),Object(j.jsx)("h3",{children:"Remote Participants"}),Object(j.jsx)("div",{className:"remote-participants",children:d})]})},m=function(){var e=Object(c.useState)(""),t=Object(s.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),i=Object(s.a)(a,2),d=i[0],b=i[1],h=Object(c.useState)(null),m=Object(s.a)(h,2),p=m[0],v=m[1],x=Object(c.useState)(!1),k=Object(s.a)(x,2),g=k[0],w=k[1],y=Object(c.useCallback)((function(e){r(e.target.value)}),[]),C=Object(c.useCallback)((function(e){b(e.target.value)}),[]),E=Object(c.useCallback)(function(){var e=Object(u.a)(o.a.mark((function e(t){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),w(!0),e.next=4,fetch("/video/token",{method:"POST",body:JSON.stringify({identity:n,room:d}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 4:c=e.sent,l.a.connect(c.token,{name:d}).then((function(e){w(!1),v(e)})).catch((function(e){console.error(e),w(!1)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[d,n]),N=Object(c.useCallback)((function(){v((function(e){return e&&(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect()),null}))}),[]);return Object(c.useEffect)((function(){if(p){var e=function(e){e.persisted||p&&N()};return window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e),function(){window.removeEventListener("pagehide",e),window.removeEventListener("beforeunload",e)}}}),[p,N]),p?Object(j.jsx)(O,{roomName:d,room:p,handleLogout:N}):Object(j.jsx)(f,{username:n,roomName:d,handleUsernameChange:y,handleRoomNameChange:C,handleSubmit:E,connecting:g})},p=function(){return Object(j.jsxs)("div",{className:"app",children:[Object(j.jsx)("header",{children:Object(j.jsx)("h1",{children:"Video Chat  with Hooks"})}),Object(j.jsx)("main",{children:Object(j.jsx)(m,{})}),Object(j.jsx)("footer",{children:Object(j.jsxs)("p",{children:["Made with"," ",Object(j.jsx)("span",{role:"img","aria-label":"React",children:"\u269b\ufe0f"})," ","by ",Object(j.jsx)("a",{href:"https://twitter.com/philnash",children:"philnash"})]})})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(j.jsx)(p,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},86:function(e,t,n){},87:function(e,t,n){}},[[202,1,2]]]);
//# sourceMappingURL=main.5b2b9baf.chunk.js.map